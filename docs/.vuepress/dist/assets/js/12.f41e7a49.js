(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{377:function(e,i,t){"use strict";t.r(i);var s=t(46),o=Object(s.a)({},(function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"metered-billing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#metered-billing"}},[e._v("#")]),e._v(" Metered billing")]),e._v(" "),t("p",[e._v("Some business cases will require dynamic subscription amounts.")]),e._v(" "),t("p",[e._v("To allow for full flexibility Cashier Mollie allows you to define your own set of Subscription OrderItem preprocessors.\nThese preprocessors are invoked when the OrderItem is due, right before being processed into a Mollie payment.")]),e._v(" "),t("p",[e._v("If you're using metered billing, this is a convenient place to calculate the amount based on the usage statistics and\nreset any counters for the next billing cycle.")]),e._v(" "),t("p",[e._v("You can define the preprocessors in the "),t("code",[e._v("cashier_plans")]),e._v(" config file.")]),e._v(" "),t("h3",{attrs:{id:"ok-so-how-does-this-all-actually-work"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ok-so-how-does-this-all-actually-work"}},[e._v("#")]),e._v(" Ok. So how does this all actually work?")]),e._v(" "),t("p",[e._v("This Cashier implementation schedules triggering payments from the client side, instead of relying on subscription management at Mollie.\n(Yes, Mollie also offers a Subscription API, but it does not support all of Cashier features, so this package provides its own subscription engine.)")]),e._v(" "),t("p",[e._v("From a high level perspective, this is what the process looks like:")]),e._v(" "),t("ol",[t("li",[e._v("A "),t("code",[e._v("Subscription")]),e._v(" is created using the "),t("code",[e._v("MandatePaymentSubscriptionBuilder")]),e._v(" (redirecting to Mollie's checkout to create\na "),t("code",[e._v("Mandate")]),e._v(") or "),t("code",[e._v("PremandatedSubscriptionBuilder")]),e._v(" (using an existing "),t("code",[e._v("Mandate")]),e._v(").")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("Subscription")]),e._v(" yields a scheduled "),t("code",[e._v("OrderItem")]),e._v(" at the beginning of each billing cycle.")]),e._v(" "),t("li",[t("code",[e._v("OrderItems")]),e._v(" which are due are preprocessed and bundled into "),t("code",[e._v("Orders")]),e._v(" whenever possible by a scheduled job (i.e.\ndaily). This is done so your customer will receive a single payment/invoice for multiple items later on in the chain).\nPreprocessing the "),t("code",[e._v("OrderItems")]),e._v(" may involve applying dynamic discounts or metered billing, depending on your\nconfiguration.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("Order")]),e._v(" is processed by the same scheduled job into a payment:\n"),t("ul",[t("li",[e._v("First, (if available) the customer's balance is processed in the "),t("code",[e._v("Order")]),e._v(".")]),e._v(" "),t("li",[e._v("If the total due is positive, a Mollie payment is incurred.")]),e._v(" "),t("li",[e._v("If the total due is 0, nothing happens.")]),e._v(" "),t("li",[e._v("If the total due is negative, the amount is added to the user's balance. If the user has no active subscriptions left, the "),t("code",[e._v("BalanceTurnedStale")]),e._v(" event will be raised.")])])]),e._v(" "),t("li",[e._v("You can generate an "),t("code",[e._v("Invoice")]),e._v(" (html/pdf) for the user.")])])])}),[],!1,null,null,null);i.default=o.exports}}]);